// Generated by CoffeeScript 1.6.2
(function() {
  var checkEnName, checkRuName, getEnName, getRuName, name_query, parse, _q;

  _q = require("./pedia-query");

  name_query = "\nselect distinct ?s, ?name, ?label, ?foaf_name\nwhere\n{\n?s ?p ?o.\noptional { ?s dbpprop:name ?name }\noptional { ?s rdfs:label ?label }\noptional { ?s foaf:name ?foaf_name }\noptional { ?s dbpprop:nativeName ?native_name }\nFILTER (?s = <{0}>)\n}";

  checkRuName = function(n) {
    var name, name_lang;

    if (!n) {
      return null;
    }
    name = n.value.toLowerCase();
    name_lang = n["xml:lang"];
    if (name_lang === "en" || name_lang === "uk") {
      if (name.match(/^[\u0400-\u04FF\s]+$/gi)) {
        return name;
      }
    }
    return null;
  };

  checkEnName = function(n) {
    var name, name_lang;

    if (!n) {
      return null;
    }
    name = n.value.toLowerCase();
    name_lang = n["xml:lang"];
    if (name_lang === "en" || name_lang === "uk") {
      return name;
    } else {
      return null;
    }
  };

  getRuName = function(i) {
    var foaf_name, label, n, name, r, _i, _len, _ref;

    name = checkRuName(i.name);
    label = checkRuName(i.label);
    foaf_name = checkRuName(i.foaf_name);
    r = "";
    _ref = [name, label, foaf_name];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      n = _ref[_i];
      if (!r || (n && n.length < r.length)) {
        r = n;
      }
    }
    return r;
  };

  getEnName = function(i) {
    var foaf_name, label, n, name, r, _i, _len, _ref;

    name = checkRuName(i.name);
    label = checkRuName(i.label);
    foaf_name = checkRuName(i.foaf_name);
    if (name) {
      name = null;
    } else {
      name = checkEnName(i.name);
    }
    if (label) {
      label = null;
    } else {
      label = checkEnName(i.label);
    }
    if (foaf_name) {
      foaf_name = null;
    } else {
      name = checkEnName(i.foaf_name);
    }
    r = "";
    _ref = [name, label, foaf_name];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      n = _ref[_i];
      if (!r || (n && n.length < r.length)) {
        r = n;
      }
    }
    return r;
  };

  parse = function(bindings) {
    var en_name, i, item, ru_name, _i, _len;

    item = {
      id: null,
      en_name: "",
      ru_name: ""
    };
    for (_i = 0, _len = bindings.length; _i < _len; _i++) {
      i = bindings[_i];
      item.id = i.s.value;
      ru_name = getRuName(i);
      en_name = getEnName(i);
      if (!item.ru_name || (ru_name && item.ru_name.length > ru_name.length)) {
        item.ru_name = ru_name;
      }
      if (!item.en_name || (en_name && item.en_name.length > en_name.length)) {
        item.en_name = en_name;
      }
    }
    return item;
  };

  module.exports = function(uri, s, done) {
    var q;

    q = name_query.replace("{0}", s);
    return _q(uri, q, function(err, b) {
      var d;

      if (!err) {
        d = parse(b);
      }
      return done(err, d);
    });
  };

}).call(this);

/*
//@ sourceMappingURL=pedia-org-name.map
*/
